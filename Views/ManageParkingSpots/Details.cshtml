

@model garage3.Data.ParkingSpot

@{
    ViewData["Title"] = "Parking Spot Details";

    var activeParkings = Model.Parkings
        .Where(p => p.CheckOutTime == null)
        .OrderByDescending(p => p.CheckInTime)
        .ToList();

    var pastParkings = Model.Parkings
        .Where(p => p.CheckOutTime != null)
        .OrderByDescending(p => p.CheckOutTime)
        .ToList();
}

<h1>Parking Spot Details</h1>

<div class="mb-4">
    <h4>Parking Spot</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-3">Spot Number</dt>
        <dd class="col-sm-9">@Model.SpotNumber</dd>

        <dt class="col-sm-3">Size</dt>
        <dd class="col-sm-9">@Model.Size</dd>

        <dt class="col-sm-3">Admin Reserved</dt>
        <dd class="col-sm-9">
            @if (Model.IsAdminReserved)
            {
                <span class="badge text-bg-secondary">
                    Yes
                    @if (!string.IsNullOrWhiteSpace(Model.ReservedReason))
                    {
                        <span class="ms-1">(@Model.ReservedReason)</span>
                    }
                </span>
            }
            else
            {
                <span class="badge text-bg-success">No</span>
            }
        </dd>
    </dl>
</div>

<hr />

<h4>Active Parking</h4>

@if (!activeParkings.Any())
{
    <p class="text-muted">No active parking on this spot.</p>
}
else
{
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>Vehicle</th>
                <th>Owner</th>
                <th>Check-in</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var p in activeParkings)
        {
            <tr>
                <td>@(p.Vehicle?.RegistrationNumber ?? "-")</td>
                <td>@(p.Vehicle?.Owner?.UserName ?? "-")</td>
                <td>@p.CheckInTime.ToString("yyyy-MM-dd HH:mm")</td>
            </tr>
        }
        </tbody>
    </table>
}

<hr />

<h4>Parking History</h4>

@if (!pastParkings.Any())
{
    <p class="text-muted">No previous parkings for this spot.</p>
}
else
{
    <table class="table table-sm table-hover">
        <thead>
            <tr>
                <th>Vehicle</th>
                <th>Owner</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var p in pastParkings)
        {
            var duration = p.CheckOutTime!.Value - p.CheckInTime;

            <tr>
                <td>@(p.Vehicle?.RegistrationNumber ?? "-")</td>
                <td>@(p.Vehicle?.Owner?.UserName ?? "-")</td>
                <td>@p.CheckInTime.ToString("yyyy-MM-dd HH:mm")</td>
                <td>@p.CheckOutTime.Value.ToString("yyyy-MM-dd HH:mm")</td>
                <td>@($"{(int)duration.TotalHours}h {duration.Minutes}m")</td>
            </tr>
        }
        </tbody>
    </table>
}

<div class="mt-4">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-warning">
        Edit
    </a>
    <a asp-action="Index" class="btn btn-outline-secondary ms-2">
        Back to List
    </a>
</div>
